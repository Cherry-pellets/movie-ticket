(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-24d4a44b"],{"159b":function(e,t,a){var n=a("da84"),r=a("fdbc"),o=a("17c2"),i=a("9112");for(var l in r){var c=n[l],s=c&&c.prototype;if(s&&s.forEach!==o)try{i(s,"forEach",o)}catch(e){s.forEach=o}}},"17c2":function(e,t,a){"use strict";var n=a("b727").forEach,r=a("a640")("forEach");e.exports=r?[].forEach:function(e){return n(this,e,arguments.length>1?arguments[1]:void 0)}},"3b41":function(e,t,a){"use strict";a.r(t);var n=a("1da1"),r=(a("159b"),a("96cf"),a("fc91")),o=a("5c96"),i={name:"MovieSchedule",data:function(){return{tableData:[],total:0,currentPage:1,scheduleInfo:{},dialogFormVisible:!1,addDialogFormVisible:!1,dialogTitle:"",labelPosition:"right",input:"",searchInput:"",rules:{movieId:[{required:!0,message:"电影名不能为空",trigger:"change"}],cinemaId:[{required:!0,message:"影院名不能为空",trigger:"change"}],hallId:[{required:!0,message:"影厅名不能为空",trigger:"change"}],movieShowDate:[{required:!0,message:"放映日期不能为空",trigger:"change"}],movieShowTime:[{required:!0,message:"放映时间不能为空",trigger:"change"}],price:[{required:!0,message:"售价不能为空",trigger:"blur"},{validator:function(e,t,a){t?/((^[1-9]\d*)|^0)(\.\d{0,2}){0,1}$/.test(t)?a():a(new Error("请输入正确格式的售价")):a(new Error("售价不能为空"))},trigger:"blur"}]},movieOptions:[],cinemaOptions:[],hallOptions:[],timeOptions:[{label:"08:05",value:"08:05"},{label:"09:05",value:"09:05"},{label:"10:05",value:"10:05"},{label:"11:05",value:"11:05"},{label:"12:05",value:"12:05"},{label:"14:05",value:"14:05"},{label:"16:05",value:"16:05"},{label:"20:05",value:"20:05"},{label:"21:05",value:"21:05"}],moviePublicDate:"",datePickerOptions:{disabledDate:this.disabledDate}}},created:function(){this.loadCurrentPageMovieSchedule(this.currentPage,8,"")},methods:{loadCurrentPageMovieSchedule:function(e,t,a){var o=this;return Object(n.a)(regeneratorRuntime.mark((function n(){var i,l;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Object(r.f)({pageNum:e,limit:t,keyword:a});case 2:i=n.sent,l=i.data,200===i.status&&200===l.state&&(o.tableData=l.data.beanList,o.total=l.data.tr);case 6:case"end":return n.stop()}}),n)})))()},currentChange:function(e){var t=this;return Object(n.a)(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:t.currentPage=e,t.loadCurrentPageMovieSchedule(t.currentPage,8,t.searchInput);case 2:case"end":return a.stop()}}),a)})))()},handleEdit:function(e,t){console.log(e,t)},handleDelete:function(e,t){var a=this;return Object(n.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o.MessageBox.confirm("此操作将永久删除该电影排片所有信息, 是否继续？","提示").then(function(){var e=Object(n.a)(regeneratorRuntime.mark((function e(n){var i,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("confirm"!==n){e.next=7;break}return e.next=3,Object(r.c)({timesId:t.id,daysId:t.days.id});case 3:i=e.sent,l=i.data,200===i.status&&200===l.state&&(o.Message.success("删除该电影排片成功！"),a.loadCurrentPageMovieSchedule(a.currentPage,8,a.searchInput),console.log(a.tableData));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}}),e)})))()},search:function(){this.searchInput=this.input,this.loadCurrentPageMovieSchedule(1,8,this.searchInput)},addSchedule:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){var a,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.scheduleInfo={},e.moviePublicDate="",t.next=4,Object(r.h)({});case 4:a=t.sent,n=a.data,200===a.status&&200===n.state&&(e.movieOptions=n.data.movies,e.cinemaOptions=n.data.cinemas),e.addDialogFormVisible=!0;case 9:case"end":return t.stop()}}),t)})))()},changeCinema:function(e){var t=this;return Object(n.a)(regeneratorRuntime.mark((function a(){var n,o;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return t.hallOptions=[],a.next=3,Object(r.g)({cinemaId:e});case 3:n=a.sent,o=n.data,200===n.status&&200===o.state&&(t.hallOptions=o.data);case 7:case"end":return a.stop()}}),a)})))()},changeMovie:function(e){var t=this;e&&this.movieOptions.forEach((function(a){a.id===e&&(t.moviePublicDate=a.rt)}))},disabledDate:function(e){return this.scheduleInfo.movieId?new Date(this.moviePublicDate)-new Date>0?e.getTime()<new Date(this.moviePublicDate):e.getTime()<new Date:e.getTime()>0},addScheduleInfo:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){var a,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(console.log(e.scheduleInfo),!(e.scheduleInfo.movieId&&e.scheduleInfo.cinemaId&&e.scheduleInfo.hallId&&e.scheduleInfo.movieShowDate&&e.scheduleInfo.movieShowTime&&e.scheduleInfo.price&&/((^[1-9]\d*)|^0)(\.\d{0,2}){0,1}$/.test(e.scheduleInfo.price))){t.next=10;break}return t.next=4,Object(r.a)({movieId:e.scheduleInfo.movieId,cinemaId:e.scheduleInfo.cinemaId,hallId:e.scheduleInfo.hallId,showDate:e.scheduleInfo.movieShowDate,showTime:e.scheduleInfo.movieShowTime,price:e.scheduleInfo.price});case 4:a=t.sent,n=a.data,200===a.status&&200===n.state&&(o.Message.success("添加电影排片成功！"),e.addDialogFormVisible=!1,e.loadCurrentPageMovieSchedule(e.currentPage,8,e.searchInput)),t.next=11;break;case 10:o.Message.error("请完成必填内容！");case 11:case"end":return t.stop()}}),t)})))()}}},l=(a("e781"),a("2877")),c=Object(l.a)(i,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"movie-schedule"}},[a("div",{staticClass:"top"},[a("el-col",{attrs:{span:12}},[a("el-input",{staticClass:"input-with-select",staticStyle:{width:"100%"},attrs:{placeholder:"请输入内容"},model:{value:e.input,callback:function(t){e.input=t},expression:"input"}},[a("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:e.search},slot:"append"},[e._v("搜索")])],1)],1),a("el-col",{attrs:{span:2,offset:1}},[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.addSchedule}},[e._v("安排电影")])],1)],1),a("div",{staticClass:"schedule-table"},[a("el-table",{staticStyle:{width:"100%"},attrs:{border:"",data:e.tableData}},[a("el-table-column",{attrs:{label:"排片 ID",align:"center",width:"100",prop:"id"}}),a("el-table-column",{attrs:{label:"电影名","show-overflow-tooltip":"",prop:"movieNm"}}),a("el-table-column",{attrs:{label:"影院名","show-overflow-tooltip":"",prop:"cinemaNm"}}),a("el-table-column",{attrs:{label:"放映大厅",prop:"hallNm"}}),a("el-table-column",{attrs:{label:"放映日期",prop:"days.day"}}),a("el-table-column",{attrs:{label:"放映时间",prop:"time"}}),a("el-table-column",{attrs:{label:"售价（元）",prop:"price"}}),a("el-table-column",{attrs:{width:"100",align:"center",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(a){return e.handleDelete(t.$index,t.row)}}},[e._v("撤销")])]}}])})],1)],1),e.tableData.length?a("div",{staticClass:"block"},[a("el-pagination",{attrs:{background:"",layout:"prev, pager, next","page-size":8,"page-count":e.total},on:{"current-change":e.currentChange}})],1):e._e(),a("div",[e.addDialogFormVisible?a("el-dialog",{attrs:{title:"添加排片",visible:e.addDialogFormVisible,"modal-append-to-body":!1,"show-close":!1},on:{"update:visible":function(t){e.addDialogFormVisible=t}}},[a("el-form",{attrs:{"label-position":e.labelPosition,rules:e.rules,"label-width":"80px",model:e.scheduleInfo}},[a("el-form-item",{attrs:{label:"电影名",prop:"movieId"}},[a("el-col",{attrs:{span:12}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},on:{change:e.changeMovie},model:{value:e.scheduleInfo.movieId,callback:function(t){e.$set(e.scheduleInfo,"movieId",t)},expression:"scheduleInfo.movieId"}},e._l(e.movieOptions,(function(e){return a("el-option",{key:e.id,attrs:{label:e.nm,value:e.id}})})),1)],1)],1),a("el-form-item",{attrs:{label:"影院",prop:"cinemaId"}},[a("el-col",{attrs:{span:12}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},on:{change:e.changeCinema},model:{value:e.scheduleInfo.cinemaId,callback:function(t){e.$set(e.scheduleInfo,"cinemaId",t)},expression:"scheduleInfo.cinemaId"}},e._l(e.cinemaOptions,(function(e){return a("el-option",{key:e.id,attrs:{label:e.nm,value:e.id}})})),1)],1)],1),a("el-form-item",{attrs:{label:"影厅",prop:"hallId"}},[a("el-col",{attrs:{span:12}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},model:{value:e.scheduleInfo.hallId,callback:function(t){e.$set(e.scheduleInfo,"hallId",t)},expression:"scheduleInfo.hallId"}},e._l(e.hallOptions,(function(e){return a("el-option",{key:e.id,attrs:{label:e.id+" 号厅",value:e.id}})})),1)],1)],1),a("el-form-item",{attrs:{label:"上映日期",prop:"public_date"}},[a("el-col",{attrs:{span:12}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date",readonly:""},model:{value:e.moviePublicDate,callback:function(t){e.moviePublicDate=t},expression:"moviePublicDate"}})],1)],1),a("el-form-item",{attrs:{label:"放映日期",prop:"movieShowDate"}},[a("el-col",{attrs:{span:12}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date",placeholder:"选择日期","picker-options":e.datePickerOptions,"value-format":"yyyy-MM-dd"},model:{value:e.scheduleInfo.movieShowDate,callback:function(t){e.$set(e.scheduleInfo,"movieShowDate",t)},expression:"scheduleInfo.movieShowDate"}})],1)],1),a("el-form-item",{attrs:{label:"放映时间",prop:"movieShowTime"}},[a("el-col",{attrs:{span:12}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择时间"},model:{value:e.scheduleInfo.movieShowTime,callback:function(t){e.$set(e.scheduleInfo,"movieShowTime",t)},expression:"scheduleInfo.movieShowTime"}},[a("i",{staticClass:"el-input__icon el-icon-time",attrs:{slot:"prefix"},slot:"prefix"}),e._l(e.timeOptions,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],2)],1)],1),a("el-form-item",{attrs:{label:"售价",prop:"price"}},[a("el-col",{attrs:{span:12}},[a("el-input",{staticStyle:{width:"100%"},model:{value:e.scheduleInfo.price,callback:function(t){e.$set(e.scheduleInfo,"price",t)},expression:"scheduleInfo.price"}})],1)],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.addDialogFormVisible=!1}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:e.addScheduleInfo}},[e._v("确 定")])],1)],1):e._e()],1)])}),[],!1,null,null,null);t.default=c.exports},"4bdc":function(e,t,a){},"65f0":function(e,t,a){var n=a("861d"),r=a("e8b5"),o=a("b622")("species");e.exports=function(e,t){var a;return r(e)&&("function"!=typeof(a=e.constructor)||a!==Array&&!r(a.prototype)?n(a)&&(null===(a=a[o])&&(a=void 0)):a=void 0),new(void 0===a?Array:a)(0===t?0:t)}},a640:function(e,t,a){"use strict";var n=a("d039");e.exports=function(e,t){var a=[][e];return!!a&&n((function(){a.call(null,t||function(){throw 1},1)}))}},b727:function(e,t,a){var n=a("0366"),r=a("44ad"),o=a("7b0b"),i=a("50c4"),l=a("65f0"),c=[].push,s=function(e){var t=1==e,a=2==e,s=3==e,u=4==e,d=6==e,h=7==e,m=5==e||d;return function(f,p,v,b){for(var g,I,w=o(f),y=r(w),O=n(p,v,3),S=i(y.length),k=0,D=b||l,x=t?D(f,S):a||h?D(f,0):void 0;S>k;k++)if((m||k in y)&&(I=O(g=y[k],k,w),e))if(t)x[k]=I;else if(I)switch(e){case 3:return!0;case 5:return g;case 6:return k;case 2:c.call(x,g)}else switch(e){case 4:return!1;case 7:c.call(x,g)}return d?-1:s||u?u:x}};e.exports={forEach:s(0),map:s(1),filter:s(2),some:s(3),every:s(4),find:s(5),findIndex:s(6),filterOut:s(7)}},e781:function(e,t,a){"use strict";a("4bdc")},e8b5:function(e,t,a){var n=a("c6b6");e.exports=Array.isArray||function(e){return"Array"==n(e)}},fc91:function(e,t,a){"use strict";a.d(t,"e",(function(){return r})),a.d(t,"i",(function(){return o})),a.d(t,"b",(function(){return i})),a.d(t,"f",(function(){return l})),a.d(t,"h",(function(){return c})),a.d(t,"g",(function(){return s})),a.d(t,"a",(function(){return u})),a.d(t,"c",(function(){return d})),a.d(t,"d",(function(){return h}));var n=a("a27e"),r=function(e){return Object(n.a)({url:"/admin/movie/getMovies",method:"GET",params:e})},o=function(e){return Object(n.a)({url:"/admin/movie/addMoive",method:"POST",data:e})},i=function(e){return Object(n.a)({url:"/admin/movie/deleteMovie",method:"POST",data:e})},l=function(e){return Object(n.a)({url:"/admin/schedule/getMovieSchedule",method:"GET",params:e})},c=function(e){return Object(n.a)({url:"/admin/schedule/getOptions",method:"GET",params:e})},s=function(e){return Object(n.a)({url:"/admin/schedule/getHallByCinema",method:"GET",params:e})},u=function(e){return Object(n.a)({url:"/admin/schedule/addScheduleInfo",method:"POST",data:e})},d=function(e){return Object(n.a)({url:"/admin/schedule/deleteMovieSchedule",method:"POST",data:e})},h=function(e){return Object(n.a)({url:"/admin/schedule/getMovieSchedule",method:"GET",params:e})}}}]);