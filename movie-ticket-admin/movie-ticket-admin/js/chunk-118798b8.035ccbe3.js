(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-118798b8"],{2934:function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));var n=a("a27e"),r=function(e){return Object(n.a)({url:"/admin/movie/upLoadFile",method:"POST",data:e,headers:{"Content-Type":"multipart/form-data"}})}},"37cb":function(e,t,a){"use strict";a("f4d6")},"3b7a":function(e,t,a){"use strict";a.r(t);var n=a("1da1"),r=(a("96cf"),a("a27e")),i=function(e){return Object(r.a)({url:"/admin/banner/getBanner",method:"GET",params:e})},o=function(e){return Object(r.a)({url:"/admin/banner/addBanner",method:"POST",data:e})},s=function(e){return Object(r.a)({url:"/admin/banner/deleteBanner",method:"POST",data:e})},l=a("2934"),u=a("5c96"),c={name:"BannerManage",data:function(){return{tableData:[],total:0,currentPage:1,bannerInfo:{},dialogFormVisible:!1,dialogTitle:"",labelPosition:"right",input:"",searchInput:"",rules:{img:[{required:!0,message:"广告图片不能为空",trigger:"blur"}]}}},created:function(){this.loadCurrentPageBanner(this.currentPage,8,"")},methods:{loadCurrentPageBanner:function(e,t,a){var r=this;return Object(n.a)(regeneratorRuntime.mark((function n(){var o,s;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,i({pageNum:e,limit:t,keyword:a});case 2:o=n.sent,s=o.data,200===o.status&&200===s.state&&(r.tableData=s.data.beanList,r.total=s.data.tr);case 6:case"end":return n.stop()}}),n)})))()},currentChange:function(e){var t=this;return Object(n.a)(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:t.currentPage=e,t.loadCurrentPageBanner(t.currentPage,8,t.searchInput);case 2:case"end":return a.stop()}}),a)})))()},handleEdit:function(e,t){this.dialogTitle="编辑广告信息",this.bannerInfo=t,this.dialogFormVisible=!0,console.log(e,t)},handleDelete:function(e,t){var a=this;return Object(n.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:u.MessageBox.confirm("此操作将永久删除该广告信息, 是否继续？","提示").then(function(){var e=Object(n.a)(regeneratorRuntime.mark((function e(n){var r,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("confirm"!==n){e.next=7;break}return e.next=3,s({bannerId:t.id});case 3:r=e.sent,i=r.data,200===r.status&&200===i.state&&(a.loadCurrentPageBanner(a.currentPage,8,a.searchInput),u.Message.success("删除该广告成功！"));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}}),e)})))()},changeImg:function(){var e=new FileReader;console.log(this.$refs.uploadImg.files),e.readAsDataURL(this.$refs.uploadImg.files[0]);var t=this;e.onload=function(){t.$refs.previewImg.src=this.result,t.bannerInfo.img=this.result}},manageBannerInfo:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){var a,n,r,i,s,c;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.bannerInfo.img){t.next=30;break}if(!e.$refs.uploadImg.files[0]){t.next=15;break}return(a=new FormData).append("img",e.$refs.uploadImg.files[0]),t.next=6,Object(l.a)({formData:a});case 6:if(n=t.sent,r=n.data,200!==n.status||200!==r.state){t.next=13;break}r.data&&(e.bannerInfo.img=r.data.img),t.next=15;break;case 13:return u.Message.error(r.message),t.abrupt("return");case 15:if("编辑广告信息"!==e.dialogTitle){t.next=24;break}return t.next=18,o({data:e.bannerInfo});case 18:i=t.sent,s=i.data,200===i.status&&200===s.state?(e.dialogFormVisible=!1,u.Message.success("修改广告信息成功！")):u.Message.error(s.message),t.next=28;break;case 24:return t.next=26,o({banner:e.bannerInfo});case 26:200===(c=t.sent).state?(e.loadCurrentPageBanner(e.currentPage,8,e.searchInput),e.dialogFormVisible=!1,u.Message.success("添加广告成功！")):u.Message.error(c.message);case 28:t.next=31;break;case 30:u.Message.error("请完成必填内容！");case 31:case"end":return t.stop()}}),t)})))()},addBanner:function(){this.dialogTitle="添加广告",this.bannerInfo={},this.dialogFormVisible=!0},cancel:function(){this.dialogFormVisible=!1,this.loadCurrentPageBanner(this.currentPage,8,this.searchInput)}}},d=(a("37cb"),a("2877")),g=Object(d.a)(c,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"movie-manage"}},[a("div",{staticClass:"top"},[a("el-col",{staticStyle:{flex:"auto","align-self":"flex-start"},attrs:{span:2,offset:1}},[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.addBanner}},[e._v("添加广告")])],1)],1),a("div",{staticClass:"banner-table"},[a("el-table",{attrs:{border:"",data:e.tableData}},[a("el-table-column",{attrs:{label:"广告 ID",align:"center",width:"100",prop:"id"}}),a("el-table-column",{attrs:{label:"图片 URL","show-overflow-tooltip":"",prop:"img"}}),a("el-table-column",{attrs:{label:"跳转 URL","show-overflow-tooltip":"",prop:"url"}}),a("el-table-column",{attrs:{width:"200",align:"center",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"mini"},on:{click:function(a){return e.handleEdit(t.$index,t.row)}}},[e._v("编辑")]),a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(a){return e.handleDelete(t.$index,t.row)}}},[e._v("删除")])]}}])})],1)],1),e.tableData.length?a("div",{staticClass:"block"},[a("el-pagination",{attrs:{background:"",layout:"prev, pager, next","page-size":8,"page-count":e.total},on:{"current-change":e.currentChange}})],1):e._e(),a("div",[e.dialogFormVisible?a("el-dialog",{attrs:{title:e.dialogTitle,visible:e.dialogFormVisible,"modal-append-to-body":!1,showClose:!1},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("el-form",{attrs:{"label-position":e.labelPosition,rules:e.rules,"label-width":"80px",model:e.bannerInfo}},[a("el-form-item",{attrs:{label:"广告图片",prop:"img"}},[a("el-col",{attrs:{span:16}},[a("img",{ref:"previewImg",attrs:{src:e.bannerInfo.img,alt:"",width:"375px",height:"150px"}}),a("div",{staticStyle:{position:"relative",height:"64px"}},[a("el-button",{staticStyle:{position:"absolute",left:"0",top:"0",cursor:"pointer"},attrs:{size:"small",type:"primary"}},[e._v("点击上传")]),a("input",{ref:"uploadImg",staticStyle:{position:"absolute",left:"0",top:"0",opacity:"0",height:"32px",width:"80px",cursor:"pointer"},attrs:{type:"file",id:"file",name:"file",accept:"image/png, image/jpeg, image/gif, image/jpg"},on:{change:e.changeImg}}),a("div",{staticClass:"el-upload__tip",staticStyle:{position:"absolute",left:"0",top:"32px",height:"32px"},attrs:{slot:"tip"},slot:"tip"},[e._v("只能上传jpg/png文件，且不超过500kb")])],1)])],1),a("el-form-item",{attrs:{label:"跳转 URL",prop:"firstTitle"}},[a("el-col",{attrs:{span:16}},[a("el-input",{model:{value:e.bannerInfo.url,callback:function(t){e.$set(e.bannerInfo,"url",t)},expression:"bannerInfo.url"}})],1)],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.cancel}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.manageBannerInfo()}}},[e._v("确 定")])],1)],1):e._e()],1)])}),[],!1,null,null,null);t.default=g.exports},f4d6:function(e,t,a){}}]);